{% load static %}

<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{% static 'tracker/css/tracker.css' %}">
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-100638725-1', 'auto');
        ga('send', 'pageview');
    </script>
</head>
<body>
<h3>CTS Plant Tracker Prototype</h3>
<div id="map"></div>
<div id=waypoints>
    {{content}}
</div>

<script type="text/javascript" src="{% static 'tracker/js/map.js'%}"></script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&callback=initMap">
</script>
<script src="{% static 'jquery/jquery-1.10.2.js' %}" type="text/javascript"></script>
<script src="{% static 'js/jquery-ui-1.10.4.custom.min.js' %}" type="text/javascript"></script>

<script>
    var marker;
    var waypointByID = {};
    {% for waypoint in waypoints %}
        waypointByID[{{waypoint.id}}] = {
            name: "{{waypoint.name}}",
            lat: {{waypoint.geometry.y}},
            lng: {{waypoint.geometry.x}}
        };
    {% endfor %}
    $(document).ready(function () {
        function activateWaypoints() {
            // Add waypoint click handler
            $('.waypoint').each(function () {
                $(this).click(function() {
                    var waypoint = waypointByID[this.id];
                    var center = new google.maps.LatLng(waypoint.lat, waypoint.lng);
                    if (marker) marker.setMap();
                    marker = new google.maps.Marker({map: map, position: center});
                    map.panTo(center);
                }).hover(
                    function () {this.className = this.className.replace('OFF', 'ON');},
                    function () {this.className = this.className.replace('ON', 'OFF');}
                );
            });
        }
        activateWaypoints();
    });
</script>
</body>
</html>